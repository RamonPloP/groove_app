{% extends "layouts/base.html" %}

{% block title %} {% if type == 'work_shift' %}Agregar segunda joranda{% else %}Editar empleado {% endif %}{% endblock %}

<!-- Element injected in the BODY element -->
{% block body_class %} sidebar-mini {% endblock body_class %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
     <!-- Select2 -->
  <link rel="stylesheet" href="/static/assets/plugins/select2/css/select2.min.css">
  <link rel="stylesheet" href="/static/assets/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="/static/assets/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="/static/assets/plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="/static/assets/css/adminlte.min.css">
  <!-- Toastr -->
  <link rel="stylesheet" href="/static/assets/plugins/toastr/toastr.min.css">
     <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="/static/assets/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <!-- SweetAlert2 -->
  <link rel="stylesheet" href="/static/assets/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">

{% endblock stylesheets %}

{% block content %}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>{% if type == 'work_shift' %}Agregar segunda joranda{% else %}Editar empleado {% endif %} </h1>
          </div>
          <div class="col-sm-6">

          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <!-- left column -->
          <div class="col-md-12">
            <!-- jquery validation -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Datos Generales</h3>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <form id="addForm"  method="post">
                <div class="card-body">
                    <div class="row">
                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="employee_type">Tipo de Empleado</label>
                                <select name="employee_type" id="employee_type" class="form-control" style="width: 100%;" {% if type == 'work_shift' %}readonly{% endif %}>
                                {% if employee.employee_type == 5 %}
                                    <option value="5">Doble Jornada</option>
                                {% else %}
                                    {% if type == 'work_shift' %}
                                        <option value="5">Doble Jornada</option>
                                    {% else %}
                                        {% for data in employee_type %}
                                            {% if data[0] != 5 %}
                                                {% if data[0] != 1 and current_user.role != 5 %}
                                                    <option {% if data[0] == employee.employee_type %} selected="selected" {% endif %} value ="{{ data[0] }}" >{{ data[1] }}</option>
                                                {% elif current_user.role == 5 %}
                                                    <option {% if data[0] == employee.employee_type %} selected="selected" {% endif %} value ="{{ data[0] }}" >{{ data[1] }}</option>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                {% endif %}
                                  </select>
                            </div>
                        </div>
                         <div class="col-md-3">
                            <div class="form-group">
                                <label for="name">Nombre(s) <code>*</code></label>
                                <input type="text" name="type" value="{{ type }}" hidden required>
                                <input type="text" name="id" class="form-control" id="id" placeholder="Numero de empleado" value="{{ employee.id }}" hidden required>
                                <input type="text" name="name" class="form-control" id="name" placeholder="Nombre" value="{{ employee.name }}" oninput="this.value = this.value.toUpperCase()" required {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="last_name">Apellido paterno <code>*</code></label>
                                <input type="text" name="last_name" class="form-control" id="last_name" placeholder="Apellido paterno" value="{{ employee.last_name }}" oninput="this.value = this.value.toUpperCase()" required {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="last_name">Apellido materno</label>
                                <input type="text" name="middle_name" class="form-control" id="middle_name" placeholder="Apellido materno" value="{{ '' if employee.middle_name == none else employee.middle_name}}" oninput="this.value = this.value.toUpperCase()" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                              <label>Fecha de nacimiento <code>*</code></label>
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                </div>
                                <input type="text" name="birth_date" id="birth_date" class="form-control" data-inputmask-alias="datetime" data-inputmask-inputformat="dd/mm/yyyy" value="{{employee.birth_date.strftime('%d/%m/%Y')}}" {% if type == 'work_shift' %}readonly{% endif %}>
                              </div>
                              <!-- /.input group -->
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="employer_registration_id">Genero <code>*</code> </label>
                                <select name="gender" id="gender" class="form-control " style="width: 100%;" {% if type == 'work_shift' %}readonly{% endif %}>
                                    <option>Selecciona una opción</option>
                                    <option {% if employee.gender == "H" %} selected="selected" {% endif %} value="H">MASCULINO</option>
                                    <option {% if employee.gender == "M" %} selected="selected" {% endif %} value="M">FEMENINO</option>
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="state">Estado <code>*</code></label>
                                 <select name="state" id="state" class="form-control select2" style="width: 100%;" required {% if type == 'work_shift' %}readonly{% endif %}>
                                    <option selected="selected">Selecciona una opción</option>
                                    {% for data in state_no %}
                                        <option {% if data.id == employee_city.state_id %} selected="selected" {% endif %}  value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="employer_registration_id">Ciudad <code>*</code></label>
                                  <select name="city_id" id="city_id" class="form-control select2" style="width: 100%;" required {% if type == 'work_shift' %}readonly{% endif %}>
                                    <option selected="selected">Selecciona una opción</option>
                                    {% for data in citys_by_state %}
                                        <option {% if data.id == employee.city_id %} selected="selected" {% endif %} value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="curp">CURP <code>*</code></label>
                                <input type="text" name="curp" class="form-control" id="curp" placeholder="CURP" value="{{ employee.curp}}{% if type == 'work_shift' %}-2{% endif %}"  required {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="rfc">RFC <code>*</code></label>
                                <input type="text" minlength="13" maxlength="15" name="rfc" class="form-control" id="rfc" placeholder="RFC"  value="{{ employee.rfc}}{% if type == 'work_shift' %}-2{% endif %}" required {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="employer_registration_id">Tipo de sangre</label>
                                <select name="blood_type" id="blood_type" class="form-control " style="width: 100%;" {% if type == 'work_shift' %}readonly{% endif %}>
                                    <option value="">Selecciona una opción</option>
                                    <option {% if employee.blood_type == "A+" %} selected="selected" {% endif %}  value="A+">A+</option>
                                    <option {% if employee.blood_type == "A-" %} selected="selected" {% endif %} value="A-">A-</option>
                                    <option {% if employee.blood_type == "B+" %} selected="selected" {% endif %} value="B+">B+</option>
                                    <option {% if employee.blood_type == "B-" %} selected="selected" {% endif %} value="B-">B-</option>
                                    <option {% if employee.blood_type == "AB+" %} selected="selected" {% endif %} value="AB+">AB+</option>
                                    <option {% if employee.blood_type == "AB-" %} selected="selected" {% endif %} value="AB-">AB-</option>
                                    <option {% if employee.blood_type == "O+" %} selected="selected" {% endif %} value="O+">O+</option>
                                    <option {% if employee.blood_type == "O-" %} selected="selected" {% endif %} value="O-">O-</option>
                                  </select>
                            </div>
                        </div>

                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="type_overtime_id">Teléfono</label>
                                <input type="text" minlength="10" maxlength="10"  oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" name="telephone" class="form-control" id="telephone" placeholder="Teléfono" value="{{ employee.telephone }}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="postal_code">Codigo postal</label>
                                <input type="number" name="postal_code" class="form-control" id="postal_code" placeholder="Codigo postal" value="{{ employee.postal_code or ''}}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="suburb">Colonia</label>
                                <input type="text" name="suburb" class="form-control" id="suburb" placeholder="Colonia" value="{{ employee.suburb}}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="nss">Calle</label>
                                <input minlength="11" maxlength="11" type="text" name="street" class="form-control" id="street" placeholder="Calle" value="{{ employee.street}}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="external_number"># exterior</label>
                                <input type="number" name="external_number" class="form-control" id="external_number" placeholder="# exterior" value="{{ employee.external_number}}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="internal_number"># interior</label>
                                <input type="number" name="internal_number" class="form-control" id="internal_number" placeholder="# interior"  value="{{ employee.internal_number if value}}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>

                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="employer_registration_id">Registro patronal <code>*</code> </label>
                                <select name="employer_registration_id" id="employer_registration_id" class="form-control select2" style="width: 100%;">
                                    <option></option>
                                    {% for data in employerregistration %}
                                        <option  {% if data.id == employee.employer_registration_id %} selected="selected" {% endif %} value ="{{ data.id }}" >  {{ data.id  }} - {{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="state">Estado en el que labora  <code>*</code></label>
                                 <select name="location_state" id="location_state" class="form-control select2" style="width: 100%;" required {% if type == 'work_shift' %}readonly{% endif %}>
                                    <option></option>
                                    {% for data in state %}
                                        <option {% if data.id == employee_location.state_id %} selected="selected" {% endif %} value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="employer_registration_id">Ciudad en la que labora <code>*</code></label>
                                  <select name="location" id="location" class="form-control select2" style="width: 100%;" {% if type == 'work_shift' %}readonly{% endif %}>
                                    <option></option>
                                    {% for data in location_by_state %}
                                        <option {% if data.id == employee.location %} selected="selected" {% endif %} value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="suburb">CUIP</label>
                                <input type="text" name="cuip" class="form-control" id="cuip" placeholder="CUIP "  value="{{'' if employee.cuip == none else employee.cuip }}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.card-body -->
                <div class="card-header">
                    <h3 class="card-title">Datos de la nomina</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                    <div class="col-md-3">
                            <div class="form-group">
                                <label for="type_overtime_id">Tipo de nomina <code>*</code></label>
                                <select name="payroll_id" id="payroll_id" class="form-control select2" style="width: 100%;" required>
                                    <option></option>
                                    {% for data in payroll %}
                                        <option {% if data.id == employee.payroll_id %} selected="selected" {% endif %} value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="employer_registration_id">Banco</label>
                                <select name="bank_id" id="bank_id" class="form-control select2" style="width: 100%;">
                                    <option></option>
                                    {% for data in banks %}
                                        <option  {% if data.id == employee.bank_id %} selected="selected" {% endif %} value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="bank_account">Numero de cuenta</label>
                                <input type="text" pattern="^\d{9,18}(-2)?$" minlength="9" maxlength="20" name="bank_account" class="form-control" id="bank_account" placeholder="Numero de cuenta" {% if employee.bank_account is not none %} value ="{{ employee.bank_account }}{% if type == 'work_shift' %}-2{% endif %}{% endif %}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                         <div class="col-md-3">
                            <div class="form-group">
                                <label for="bank_card_number">Numero de tarjeta</label>
                                <input type="text" pattern="^\d{16}(-2)?$" minlength="16" maxlength="18" name="bank_card_number" class="form-control" id="bank_card_number" placeholder="Numero de tarjeta" {% if employee.bank_card_number is not none %} value ="{{ employee.bank_card_number }}{% if type == 'work_shift' %}-2{% endif %}{% endif %}" {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="supervisor_user_id">Supervisor <code>*</code></label>
                                <select name="supervisor_user_id" id="supervisor_user_id" class="form-control select2" style="width: 100%;"required>
                                    <option></option>
                                    {% for data in supervisor_user_id %}
                                        <option {% if data.id == employee.supervisor_user_id %} selected="selected" {% endif %}  value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
{#                        <div class="col-md-3">#}
{#                            <div class="form-group">#}
{#                                <label for="last_name">Supervisor</label>#}
{#                                <input type="text" name="supervisor" class="form-control" id="supervisor" placeholder="Supervisor" value="{{ employee.supervisor }}" required>#}
{#                            </div>#}
{#                        </div>#}
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="services_id">Nombre de la nomina: <code>*</code></label>
                                <select name="services_id" id="services_id" class="form-control select2" style="width: 100%;" required>
                                    <option></option>
                                    {% for data in services %}
                                        <option {% if data.id == employee.services_id %} selected="selected" {% endif %}  value ="{{ data.id }}" >{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3" id="salary_div">
                            <div class="form-group">
                                <label for="salary">Sueldo <code>*</code></label>
                                <input type="text" name="salary" class="form-control" id="salary" placeholder="sueldo"  {% if employee.employee_type != 2 %} onblur="alert_salary()" {% endif %} value="{{ employee.salary }}" required>
                            </div>
                        </div>
                        <div class="col-md-3" id="sdi_imss_div">
                            <div class="form-group">
                                <label for="rfc">SDI IMSS: <code>*</code> </label>
                                <input type="text" name="sdi_imss" class="form-control" id="sdi_imss" placeholder="SDI IMSS" value="{{ employee.sdi_imss }}" {% if employee.employee_type != 2 %}onblur="sdi_verify()" {% endif %}required>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="type_overtime_id">Tipo de tiempo extra</label>
                                <select name="type_overtime_id" id="type_overtime_id" class="form-control select2" style="width: 100%;" required>
                                    <option></option>
                                    {% for data in type_over_time %}
                                        <option {% if data.id == employee.type_overtime_id %} selected="selected" {% endif %}  value ="{{ data.id }}" >{{ data.type }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="nss">NSS: <code>*</code></label>
                                <input type="text" minlength="11" maxlength="13" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" name="nss" class="form-control" id="nss" placeholder="NSS" value="{{ employee.nss}}{% if type == 'work_shift' %}-2{% endif %}"  required {% if type == 'work_shift' %}readonly{% endif %}>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="pension">Porcentaje de Pensión alimenticia</label>
                                <select name="percent_pension" id="percent_pension" class="form-control select2" style="width: 100%;">
                                    {% for data in percent_pension %}
                                        <option {% if data[0] == employee.percent_pension %} selected="selected" {% endif %} value ="{{ data[0] }}" >{{ data[1] }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="pension">Pensión alimenticia</label>
                                <input type="number" step="any" name="pension" class="form-control" id="pension" placeholder="Pensión" value="{{ employee.pension}}"  readonly>
                            </div>
                        </div>
                    <div class="col-md-3 have-pension">
                            <div class="form-group">
                                <label for="pension">Nombre beneficiario pension</label>
                                <input type="text" name="pension_name" class="form-control" id="pension_name" placeholder="Nombre beneficiario" value="{% if pension_benefit.benefit_name %}{{ pension_benefit.benefit_name}}{% endif %}" >
                            </div>
                        </div>
                        <div class="col-md-3 have-pension">
                            <div class="form-group">
                                <label for="employer_registration_id">Banco beneficiario pension</label>
                                <select name="pension_bank_id" id="pension_bank_id" class="form-control select2" style="width: 100%;">
                                    <option value="" selected="selected">Selecciona una opción</option>
                                    {% for data in banks %}
                                        <option value ="{{ data.id }}" {% if data.id == pension_benefit.id %}selected="selected"{% endif %}>{{ data.name }}</option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3 have-pension">
                            <div class="form-group">
                                <label for="pension_bank_account">Numero de cuenta beneficiario pension  </label>
                                <input type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" minlength="10" maxlength="18" name="pension_bank_account" class="form-control" id="pension_bank_account" placeholder="Numero de cuenta" value="{{ pension_benefit.bank_account }}">
                            </div>
                        </div>
                        <div class="col-md-3" id="div_trade_names">
                            <div class="form-group">
                                <label for="clients_trade_name_id">Cliente: <code>*</code></label>
                                <select name="clients_trade_name_id" id="clients_trade_name_id" class="form-control select2" style="width: 100%;" required>
                                    <option></option>
                                    {% for data in clients %}
                                        <optgroup label="{{ data.business_name }}">
                                            {% for tradeName in data.clients_Trade_name %}
                                                 <option {% if tradeName.id == employee.clients_trade_name_id %} selected="selected" {% endif %} value ="{{ tradeName.id }}" > {{ tradeName.trade_name }}  </option>
                                            {% endfor %}
                                        </optgroup>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="position_id">Puesto <code>*</code> </label>
                                <select name="position_id" id="position_id" class="form-control select2" style="width: 100%;"  required>
                                    <option></option>
                                    {% for data in positions %}
                                        <option {% if data.id == employee.position_id %} selected="selected" {% endif %} value ="{{ data.id }}" >{{ data.name }} </option>
                                    {% endfor %}
                                  </select>
                            </div>
                        </div>
                    {% if current_user.role in [0,5] %}
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="bonus">Bono</label>
                                <input type="text" name="bonus" class="form-control" id="bonus" placeholder="Bono" value="{% if employee.bonus %}{{ employee.bonus }}{% endif %}">
                            </div>
                        </div>
                    {% endif %}
                </div>
                <!-- /.card-body -->
                <div class="card-header">
                    <h3 class="card-title">Datos de Recursos Humanos</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                              <label>Fecha de ingreso: <code>*</code></label>
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                </div>
                                <input type="text" name="date_start" id="date_start" class="form-control" data-inputmask-alias="datetime" data-inputmask-inputformat="dd/mm/yyyy"  value="{{ employee_rh.date_start.strftime('%d/%m/%Y')}}" required>
                              </div>
                              <!-- /.input group -->
                            </div>
                        </div>
                         <div class="col-md-3">
                            <div class="form-group">
                                <label for="infonavit">Credito Infonavit</label>
                                <select name="infonavit" id="infonavit" class="form-control" style="width: 100%;" required>
                                     <option  value="">Selecciona una opción</option>
                                     <option {% if employee.infonavit==0 %} selected="selected" {% endif %} value="0">No</option>
                                     <option {% if employee.infonavit==1 %} selected="selected" {% endif %} value="1">Si</option>
                                  </select>
                            </div>
                        </div>
                         <div class="col-md-3 have-infonavit">
                            <div class="form-group">
                                <label for="type_credit_infonavit">Tipo de credito infonavit</label>
                                <select name="type_credit_infonavit" id="type_credit_infonavit" class="form-control" style="width: 100%;" >
                                     <option value="">Selecciona una opción</option>
                                     <option {% if employee.type_credit_infonavit=='VSM' %} selected="selected" {% endif %} value="VSM">VSM</option>
                                     <option  {% if employee.type_credit_infonavit=='CF' %} selected="selected" {% endif %}  value="CF">CF</option>
                                     <option  {% if employee.type_credit_infonavit=='%' %} selected="selected" {% endif %} value="%">%</option>
                                  </select>
                            </div>
                        </div>
                        <div class="col-md-3 have-infonavit ">
                            <div class="form-group">
                                <label for="credit_value">Valor del credito</label>
                                <input type="number" step="any" name="credit_value" class="form-control" id="credit_value" placeholder="Valor del credito" value="{{ employee.credit_value }}" >
                            </div>
                        </div>
                        <div class="col-md-3 have-infonavit">
                            <div class="form-group">
                                <label for="credit_number">Numero del credito</label>
                                <input type="number" name="credit_number" class="form-control" id="credit_number" placeholder="Numero del credito" value="{{ employee.credit_number }}" >
                            </div>
                        </div>
                        <div class="col-md-3"></div>

                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="observations">Observaciones</label>
                                <textarea rows="4" type="text" name="observations" class="form-control" id="observations" placeholder="Observaciones" ></textarea>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- /.card-body -->
                <div class="card-footer">
                  <button class="float-right btn btn-primary" onclick="register(event)">Guardar</button>
                </div>
              </form>
            </div>
            <!-- /.card -->
            </div>
          <!--/.col (left) -->
          <!-- right column -->
          <div class="col-md-6">

          </div>
          <!--/.col (right) -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

  <!-- jQuery -->
  <script src="/static/assets/plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- jquery-validation -->
  <script src="/static/assets/plugins/jquery-validation/jquery.validate.min.js"></script>
  <script src="/static/assets/plugins/jquery-validation/additional-methods.min.js"></script>
  <script src="/static/assets/plugins/jquery-validation/validate.es.js"></script>
  <!-- AdminLTE App -->
  <script src="/static/assets/js/adminlte.min.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="/static/assets/js/demo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
   <!-- InputMask -->
  <script src="/static/assets/plugins/moment/moment.min.js"></script>
  <script src="/static/assets/plugins/inputmask/jquery.inputmask.min.js"></script>
    <!-- Tempusdominus Bootstrap 4 -->
  <script src="/static/assets/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
      <!-- Toastr -->
  <script src="/static/assets/plugins/toastr/toastr.min.js"></script>
       <!-- Select2 -->
  <script src="/static/assets/plugins/select2/js/select2.full.min.js"></script>
    <!-- SweetAlert -->
    <script src="/static/assets/plugins/sweetalert2/sweetalert2.min.js"></script>
  <script src="/static/assets/plugins/inputmask/jquery.maskMoney.min.js"></script>
    <script src="/static/assets/plugins/curp/curp.js"></script>
  <script>
  if($('#percent-pension').val() === undefined) {
   $('.have-pension').hide()
  }
  function hide_salary_cover(){
      document.getElementById('salary_div').style.display = 'none';
        document.getElementById('sdi_imss_div').style.display = 'none';
  }

  function show_salary_cover(){
      document.getElementById('salary_div').style.display = 'inline';
        document.getElementById('sdi_imss_div').style.display = 'inline';
  }

  if(document.getElementById('employee_type').value == '2'){
      hide_salary_cover();
  }

  $('#employee_type').change(function(){
    if(document.getElementById('employee_type').value =='2'){
        hide_salary_cover()
    }else{
        show_salary_cover()
    }
    if(document.getElementById('employee_type').value == '1'){
        get_json_staff_tradenames()
    }else{
        get_json_tradenames()
    }
})

  function get_json_staff_tradenames(){
     var clients = document.getElementById("clients_trade_name_id");
      document.getElementById('clients_trade_name_id').innerHTML = '';
     $.getJSON('/employees/staff-trade/list',function(data){
         var opcion = document.createElement("option");
         clients.appendChild(opcion)
         console.log(data)
         $.each(data, function(i, element) {
             var opcion = document.createElement("option");
            opcion.value = element.id;
            opcion.text = element.trade_name;
            clients.appendChild(opcion);
         })
     })
    }

    function get_json_tradenames(){
     var clients = document.getElementById("clients_trade_name_id");
      document.getElementById('clients_trade_name_id').innerHTML = '';
     $.getJSON('/employees/trade-names/list',function(data){
         var opcion = document.createElement("option");
         clients.appendChild(opcion)
         console.log(data)
         $.each(data, function(i, element) {
             var opcion = document.createElement("option");
            opcion.value = element.id;
            opcion.text = element.trade_name;
            clients.appendChild(opcion);
         })
     })
    }

  if (document.getElementById('bank_account').value != ""){
      document.getElementById('bank_card_number').disabled = this.value != "";
  }

  if (document.getElementById('bank_card_number').value != ""){
      document.getElementById('bank_account').disabled = this.value != "";
  }

  function validate_backlist(curp) {
    axios({
            method: 'post',
            headers: {
                'Content-Type': 'application/json'
            },
            url: '/validate/blacklist',
            data: {curp:curp}
        }).then(function (response) {
            //toastr.success(response.data)
        }).catch(function (error) {
            document.getElementById("addForm").reset();
            Swal.fire({
              icon: 'warning',
              title: 'Oops...',
              text: error.response.data

            })
        });

}

  function updateCURP(){
    var state = $("#state");
    let curp = calcularCurp();
    document.getElementById('curp').value=curp;
    document.getElementById('rfc').value=curp.substring(0, 10);
    var state_id = state.val();
    get_json_city(state_id)
}

document.getElementById('name').addEventListener('change', function () {
    updateCURP()
})
document.getElementById('last_name').addEventListener('change', function () {
    updateCURP()
})
document.getElementById('middle_name').addEventListener('change', function () {
    updateCURP()
})
document.getElementById('birth_date').addEventListener('change', function () {
    updateCURP()
})
document.getElementById('gender').addEventListener('change', function () {
    updateCURP()
})

function alert_max_salary(){
    let salary = document.getElementById('salary').value.trim();
    salary = salary.replace('$', '').replace(',', '');
    salary = Number(salary);
    if(document.getElementById("employee_type").value != 1){
        if(salary>2600){
          Swal.fire({
              title: "Advertencia",
              text: `Estas agregando $${salary} de salario al empleado`,
              icon: "info"
          });
      }
    }
}

$(function () {
    var state = $("#state");
    state.on("change", function () {
        document.getElementById("city_id").innerHTML = ""
        var curp = calcularCurp();
        validate_backlist(curp)
        document.getElementById('curp').value = curp;
        document.getElementById('rfc').value = curp.substring(0, 10);
        var state_id = state.val();
        get_json_city(state_id)
    });
});

$('.select2').select2({
    placeholder: 'Selecciona una opción',
    allowClear: true
})
$('#location').select2({
    placeholder: 'Selecciona una opción',
    allowClear: true,
  {% if type == 'work_shift' %}readonly:true{% endif %}
})
$('#state').select2({
    placeholder: 'Selecciona una opción',
    allowClear: true,
  {% if type == 'work_shift' %}readonly:true{% endif %}
})
$('#salary').change(function (){
    alert_max_salary()
})
$('#birth_date').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' })
$('#date_start').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' })
//$("#salary").inputmask('currency',{rightAlign: true  });
//$("#sdi_imss").inputmask('currency',{rightAlign: true  });
$(function () {
    calculate_pension()
        // Obtener los elementos del HTML
    var state = $("#state");
    // Agregar un evento de cambio al primer input para actualizar el segundo input
    state.on("change", function() {
        document.getElementById("city_id").innerHTML=""
        var state_id = state.val();
        get_json_city(state_id)
    });

    var location_state = $("#location_state");
    location_state.on("change", function() {
        document.getElementById("location").innerHTML = ""
        var location_state_id = location_state.val();
        get_json_location(location_state_id)
    });

$('#infonavit').on("change", function() {
    infonavit =$('#infonavit').val()
    if (infonavit==1){
        $('.have-infonavit').show()
    }else{
        $('.have-infonavit').hide()
    }
});
    {% if employee.credit_number == none  or employee.credit_value == none %}
        $('.have-infonavit').hide()
    {% endif %}
    $.validator.setDefaults({
      submitHandler: function () {
        alert( "Form successful submitted!" );
      }
    });
    $('#addForm').validate({
      ignore: '.select2-input, .select2-focusser',
      rules: {
        employee_number: {
          required: true
        },
        password: {
          required: true,
          minlength: 5
        },
        terms: {
          required: true
        },
      },
      messages: {
        employee_number: {
          required: "El campo es requerido"
        },
        password: {
          required: "Please provide a password",
          minlength: "Your password must be at least 5 characters long"
        },
        terms: "Please accept our terms"
      },
      errorElement: 'span',
      errorPlacement: function (error, element) {
        error.addClass('invalid-feedback');
        element.closest('.form-group').append(error);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass('is-invalid');
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass('is-invalid');
      }
    });
    var inp1 = document.getElementById("bank_account");
    inp1.addEventListener("input", function () {
        document.getElementById("bank_card_number").disabled = this.value != "";
    });
    var inp2 = document.getElementById("bank_card_number");
    inp2.addEventListener("input", function () {
        document.getElementById("bank_account").disabled = this.value != "";
    });
    $(document.body).on("change","#percent_pension,#salary",function(){
        calculate_pension()
    });
  });

function calculate_pension(){
     let percent_pension = document.getElementById("percent_pension").value
     let salary = document.getElementById("salary").value
     if(salary !=''){
        let pension =  (percent_pension * salary )/100
        document.getElementById("pension").value = pension;
     }
     if(percent_pension==''){
         document.getElementById("pension").value = '';
     }
}

  function register(e) {
        e.preventDefault()
        var form = $("#addForm")[0]
        let data_form = new FormData(form)
        {#data_form.set('salary',$('#salary').maskMoney('unmasked')[0]);#}
        {#data_form.set('sdi_imss',$('#sdi_imss').maskMoney('unmasked')[0]);#}
        const type = '{{ type }}'
        let url = '/employees/crud'

        let client_id = parseInt($('#clients_trade_name_id').val())

        if(type == 'work_shift'){
            url = url+'/add'
        }
        if (!form.checkValidity())
            form.reportValidity()
        else {
            if (client_id == {{ employee.clients_trade_name_id }} && type == 'work_shift'){
                Swal.fire({
                  icon: 'warning',
                  title: 'Oops...',
                  text: 'El cliente debe ser diferente al ser nuevo empleado de doble jornada'
                })
            }else{
                 $("#create_button").prop("disabled", true)
                axios({
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    url: url,
                    data: data_form
                }).then(function (response) {
                    toastr.success(response.data)
                    window.location.href = "/employees/all";
                }).catch(function (error) {
                    toastr.error(error.response.data)
                    console.log(error.response)
                }).finally(function () {
                    $("form :input").prop("readonly", false)
                    $('form select').css('pointer-events', 'all')
                });
            }
        }
    }
$('#percent_pension').on("change", function() {
    infonavit =$('#percent_pension').val()
    if (infonavit!=''){
        $('.have-pension').show()
    }else{
        $('.have-pension').hide()
    }
});
    function get_json_city(state_id){
      var city = document.getElementById("city_id");
      $.getJSON('/city/list/'+state_id, function (data) {
                $.each(data, function (i, element) {
                    var opcion = document.createElement("option");
                    opcion.value = element.id;
                    opcion.text = element.name;
                    city.appendChild(opcion);
                })
            }
        );

    }
    function alert_salary() {
        let salary = document.getElementById('salary').value.trim();
        salary = salary.replace('$', '').replace(',', '');
        salary = Number(salary);
        if (salary > 2600) {
            Swal.fire({
                title: "Aviso",
                text: `Estas editando $${salary} de sueldo al empleado`,
                icon: "info"
            });
        }

       /* if (parseInt(salary) < parseInt('{{ employee.salary }}')){
            document.getElementById('salary').value = {{ employee.salary }}
            Swal.fire({
                title: "Aviso",
                text: `No puedes editar a un salario menor del que se tiene: $${ {{ employee.salary }} }`,
                icon: "error"
            });
        }*/
    }

    {#function sdi_verify() {#}
    {#    let sdi = document.getElementById('sdi_imss').value.trim();#}
    {#    sdi = sdi.replace('$', '').replace(',', '');#}
    {#    sdi = Number(sdi);#}
    {##}
    {#    if (sdi < {{ employee.sdi_imss }}){#}
    {#        document.getElementById('sdi_imss').value = {{ employee.sdi_imss }}#}
    {#        Swal.fire({#}
    {#            title: "Aviso",#}
    {#            text: `No puedes editar a un salario SDI IMSS menor del que se tiene: $${ {{ employee.sdi_imss }} }`,#}
    {#            icon: "error"#}
    {#        });#}
    {#     }#}
    {#}#}

    function get_json_location(state_id){
      var city = document.getElementById("location");
      $.getJSON('/city/list/'+state_id, function (data) {
                $.each(data, function (i, element) {
                    var opcion = document.createElement("option");
                    opcion.value = element.id;
                    opcion.text = element.name;
                    city.appendChild(opcion);
                })
            }
        );

    }



  </script>

{% endblock javascripts %}
